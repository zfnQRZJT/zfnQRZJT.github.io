<!doctype html>
<html>
  <head>
    <title>Region simulator</title>
    <script>
      const find = function(elem) {return(document.getElementById(elem));}
      var N; var ctx; var pointlocs; var lines; var intlocs = [];
      const regenerate = function() {
        N = find("howmanypoints").value;
        ctx = find("cv").getContext('2d');
        pointlocs = [];
        for (let i = 0; i < N; i++) {
          let x = 600*Math.random() - 300; let y;
          if (find("convex").checked) {
            y = Math.sqrt(300*300 - x*x)*(2*Math.floor(2*Math.random()) - 1);
          } else {
            y = 600*Math.random() - 300;
          }
          pointlocs.push([x + Math.random()*10 + 400,y + Math.random()*10 + 400]);
        }
        //now we have a bunch of points and have to connect them
        lines = [];
        for (let i = 0; i < N; i++) {
          let currarr = [];
          for (let j = 0; j < i; j++) {
            let thissplit = [[],[]];
            let p1 = pointlocs[i]; let p2 = pointlocs[j]; let sl = (p2[1] - p1[1])/(p2[0] - p1[0]);
            for (let k = 0; k < N; k++) {
              if (k !== i && k !== j) {
                if (pointlocs[k][0]*sl + p1[1] - sl*p1[0] < pointlocs[k][1]) {
                  thissplit[0].push(k);
                } else {
                  thissplit[1].push(k);
                }
              }
            }
            currarr.push([sl,p1[1] - sl*p1[0],thissplit]);
          }
          lines.push(JSON.parse(JSON.stringify(currarr)));
        }
        console.log(JSON.stringify(lines));
        console.log(pointlocs);
        //return;
        //now we have to find all those line intersections yayyyyy
        for (let i = 1; i < N; i++) {
          for (let j = 0; j < i; j++) {
            let thesplit = lines[i][j][2];
            lines[i][j].push([pointlocs[i],pointlocs[j]]);
            for (let K = 0; K < thesplit[0].length; K++) {
              for (let L = 0; L < thesplit[1].length; L++) {
                let k = thesplit[0][K]; let l = thesplit[1][L];
                let secline = lines[Math.max(k,l)][Math.min(k,l)];
                if (!(secline)) {console.log(i,j,k,l);}
                let intpointx = (secline[1]-lines[i][j][1])/(lines[i][j][0]-secline[0]);
                if (Math.min(pointlocs[i][0],pointlocs[j][0]) < intpointx && intpointx < Math.max(pointlocs[i][0],pointlocs[j][0])) {
                  //real intersection
                  let realinter = [intpointx,lines[i][j][0]*intpointx + lines[i][j][1]];
                  lines[i][j][3].push(realinter);
                  if (Math.max(i,j) > Math.max(k,l)) {
                    intlocs.push([i,j,k,l,realinter[0],realinter[1]]);
                  }
                }
              }
            }
            lines[i][j][3].sort((a,b) => a.x - b.x);
          }
        }
        ctx.fillStyle = "white";
        ctx.fillRect(0,0,800,800);
        ctx.fillStyle="black";
        for (let i = 0; i < pointlocs.length; i++) {
          for (let j = 0; j < i; j++) {
            ctx.moveTo(pointlocs[i][0],pointlocs[i][1]);
            ctx.lineTo(pointlocs[j][0],pointlocs[j][1]);
            ctx.stroke();
          }
          drawp(pointlocs[i]);
        }
        for (let i = 0; i < intlocs.length; i++) {drawp([intlocs[i][4],intlocs[i][5]]);}
      }
      const drawp = function(p) {ctx.fillRect(p[0] - 2.5,p[1] - 2.5,5);}
      //window.onload = regenerate;
    </script>
  </head>
  <body>
    <input id="howmanypoints" type="range" min="3" max="15" value="6"><br>
    <input id="convex" type="checkbox"><label for="convex">Convex or not</label><br>
    <button id="regen" onclick="regenerate()">Regenerate</button><br>
    <canvas id="cv" width="800" height="800"></canvas>
  </body>
</html>
